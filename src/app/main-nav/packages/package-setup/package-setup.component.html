<mat-toolbar>
  <span class="tb-title">Packages</span>
  <span class="spacer"></span>
  <button mat-icon-button matTooltip="Save all">
    <mat-icon aria-label="Save all">save</mat-icon>
  </button>
  <button mat-icon-button matTooltip="Download">
    <mat-icon aria-label="Download">archive</mat-icon>
  </button>
</mat-toolbar>

<mat-card>
  <mat-card-content>
    <mat-tab-group class="demo-tab-group">
      <mat-tab label="Details">
        <div class="tab-content">
          <form [formGroup]="detailsForm">
            <div>
              <mat-form-field class="full-width">
                <input type="text" matInput placeholder="Name" formControlName="name" required>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input type="number" matInput placeholder="Quota" formControlName="quota">
                <mat-hint>Quantity of persons that might join the tour</mat-hint>
              </mat-form-field>
            </div>
            <div class="dates">
              <mat-form-field>
                <input matInput [matDatepicker]="startDate" placeholder="Start date" formControlName="startDate">
                <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                <mat-datepicker #startDate></mat-datepicker>
              </mat-form-field>

              <mat-form-field>
                <input matInput [matDatepicker]="endDate" placeholder="End date" formControlName="endDate">
                <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                <mat-datepicker #endDate></mat-datepicker>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input type="number" matInput placeholder="Private rate" formControlName="privateRate">
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input type="number" matInput placeholder="Joiner rate" formControlName="joinerRate">
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Accomodation" formControlName="accomodation" multiple required>
                  <mat-option *ngFor="let acc of accomodation" [value]="acc._id">
                    {{ acc.name }} {{acc.type}} ({{acc.rooms.length}})
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Transportation" formControlName="transportation" multiple required>
                  <mat-option *ngFor="let tr of transportation" [value]="tr._id">
                    {{ tr.brand }} {{ tr.model }} [{{ tr.plate }}] ({{ tr.capacity }})
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Activities" formControlName="activities" multiple>
                  <mat-option *ngFor="let act of activities" [value]="act._id">
                    {{ act.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <textarea matInput placeholder="Description" formControlName="description"></textarea>
              </mat-form-field>
            </div>
            <div>
              <input type="file" accept="image/png, image/jpeg" multiple (change)="onFileChange($event)">
            </div>
          </form>
        </div>
      </mat-tab>
      <mat-tab label="Customers ({{customers.length}})">
        <div class="tab-content">
          <div class="filter">
            <mat-form-field>
              <input matInput (keyup)="applyCustomersFilter($event.target.value)" placeholder="Filter">
            </mat-form-field>
          </div>
          <table mat-table [dataSource]="customerDataSource" matSort>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
              <td mat-cell *matCellDef="let element"> {{element.firstName + ' ' + element.lastName}} </td>
            </ng-container>

            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef> Email </th>
              <td mat-cell *matCellDef="let element"> {{element.email}} </td>
            </ng-container>

            <ng-container matColumnDef="phone">
              <th mat-header-cell *matHeaderCellDef> Phone </th>
              <td mat-cell *matCellDef="let element"> {{element.phone}} </td>
            </ng-container>

            <ng-container matColumnDef="requested">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Request date </th>
              <td mat-cell *matCellDef="let element"> {{element.requested | date}} </td>
            </ng-container>

            <ng-container matColumnDef="rate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Rate </th>
              <td mat-cell *matCellDef="let element"> {{element.rate}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
              <td mat-cell *matCellDef="let element"> {{element.status}} </td>
            </ng-container>

            <ng-container matColumnDef="menu">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let element">
                <button mat-icon-button matTooltip="Mark as approved" (click)="setStatus(element, 'approved')" *ngIf="element.status == 'requested'">
                  <mat-icon aria-label="Approve">done</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Mark as paid" (click)="setStatus(element, 'paid')" *ngIf="element.status == 'approved'">
                  <mat-icon aria-label="Pay">credit_card</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Mark as completed" (click)="setStatus(element, 'completed')" *ngIf="element.status == 'paid'">
                  <mat-icon aria-label="Approve">done_all</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Completed" color="primary" disabled *ngIf="element.status == 'completed'">
                  <mat-icon aria-label="Approve">done_all</mat-icon>
                </button>
                <button mat-icon-button matTooltip="Remove from tour" (click)="removeFromPackage(element)">
                  <mat-icon aria-label="Remove customer">remove_circle_outline</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
          <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
        </div>
      </mat-tab>
      <mat-tab label="Transportation">
        <div class="tab-content wrap">
          <form id="transportationForm" [formGroup]="transportationForm">
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Vehicle" formControlName="vehicle">
                  <mat-option *ngFor="let tr of pkg.transportation" [value]="tr">
                    {{ tr.brand }} {{ tr.model }} [{{ tr.plate }}] ({{ tr.capacity }})
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Customers" formControlName="customers" multiple>
                  <ng-container *ngFor="let c of customers">
                    <mat-option *ngIf="c.status == 'approved' || c.status == 'paid'" [value]="c">
                      {{c.firstName + ' ' + c.lastName}} ({{c.rate}})
                    </mat-option>
                  </ng-container>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input type="text" matInput placeholder="Pick up point" formControlName="pickup" required>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input type="text" matInput placeholder="Drop off point" formControlName="dropoff" required>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input matInput [min]="pkg.startDate" [max]="pkg.endDate" [matDatepicker]="trdate" placeholder="Date" formControlName="date">
                <mat-datepicker-toggle matSuffix [for]="trdate"></mat-datepicker-toggle>
                <mat-datepicker #trdate></mat-datepicker>
              </mat-form-field>
            </div>
            <button mat-raised-button color="primary" [disabled]="transportationForm.invalid || (transportationForm.get('customers').value.length > transportationForm.get('vehicle').value.capacity)"
              (click)="setRiders()">Save</button>
            <!-- <button mat-raised-button (click)="clearTransportationForm()">Clear</button> -->
            <mat-chip-list *ngIf="transportationForm.get('customers').value && transportationForm.get('vehicle').value">
              <mat-chip>{{ transportationForm.get('customers').value.length }} / {{ transportationForm.get('vehicle').value.capacity
                }}
              </mat-chip>
            </mat-chip-list>
          </form>
          <table class="mat-table mat-elevation-z8" *ngIf="riders.length">
            <ng-container *ngFor="let ride of riders; index as i">
              <tr class="mat-header-row">
                <th class="mat-header-cell">{{ ride.vehicle.brand }} {{ ride.vehicle.model }} [{{ ride.vehicle.plate }}] ({{ride.riders.length}} / {{
                  ride.vehicle.capacity }})</th>
                <th class="mat-header-cell">{{ride.date | date}}</th>
                <th class="mat-header-cell">
                  <button mat-icon-button (click)="addCustomer2Ride(i)" *ngIf="ride.riders.length < ride.vehicle.capacity">
                    <mat-icon aria-label="Add customer">person_add</mat-icon>
                  </button>
                  <button mat-icon-button matTooltip="Delete ride" (click)="deleteRide(i)">
                    <mat-icon aria-label="Delete ride">remove_circle</mat-icon>
                  </button>
                </th>
              </tr>
              <tr class="mat-row" *ngFor="let r of ride.riders; index as j">
                <td class="mat-cell">{{r.firstName + ' ' + r.lastName}}</td>
                <td class="mat-cell">{{r.rate}}</td>
                <td class="mat-cell">
                  <!-- <button mat-icon-button>
                    <mat-icon aria-label="Move customer">compare_arrows</mat-icon>
                  </button> -->
                  <button mat-icon-button matTooltip="Delete customer from ride" (click)="deleteRider(i, j)">
                    <mat-icon aria-label="Delete customer from ride">remove_circle_outline</mat-icon>
                  </button>
                </td>
              </tr>
            </ng-container>
          </table>
        </div>
      </mat-tab>
      <mat-tab label="Accomodation">
        <div class="tab-content">

        </div>
      </mat-tab>
      <mat-tab label="Activities">
        <div class="tab-content wrap">
          <form id="activitiesForm" [formGroup]="activitiesForm">
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Activity" formControlName="id">
                  <mat-option *ngFor="let act of pkg.activities" [value]="act._id">
                    {{ act.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Guide" formControlName="guide">
                  <mat-option *ngFor="let g of guides" [value]="g._id">
                    {{ g.firstName }} {{ g.lastName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <mat-select placeholder="Customers" formControlName="customers" multiple>
                  <mat-option *ngFor="let c of customers" [value]="c._id">
                    {{ c.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field class="full-width">
                <input matInput [matDatepicker]="actdate" placeholder="Date" formControlName="date">
                <mat-datepicker-toggle matSuffix [for]="actdate"></mat-datepicker-toggle>
                <mat-datepicker #actdate></mat-datepicker>
              </mat-form-field>
            </div>
            <button mat-raised-button color="primary">Save</button>
          </form>
          <table class="mat-table mat-elevation-z8" *ngIf="activists.length">
            <thead>
              <tr class="mat-header-row">
                <th class="mat-header-cell">Customer</th>
                <th class="mat-header-cell">Vehicle</th>
                <th class="mat-header-cell">Date</th>
                <th class="mat-header-cell"></th>
              </tr>
            </thead>
            <tbody>
              <tr class="mat-row" *ngFor="let rd of riders; index as i" (click)="selectRide(i)">
                <td class="mat-cell"></td>
                <td class="mat-cell"></td>
                <td class="mat-cell"></td>
                <td class="mat-cell">
                  <button mat-button (click)="deleteRide(i)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>
